<template>
    <div i="wechat-selfmenu">
        <div class="tips">
            <i class="warning pull-left mr10"></i>
            <p>菜单编辑中</p>
            <p>菜单未发布，请确认菜单编辑完成后点击“保存并发布”同步到手机。若停用菜单，请点击这里</p>
        </div>
        <div class="div-show mt30">
            <div class="left-show pull-left mr20">
                <div class="modal-header"></div>
                <div class="modal-body">
                    <div class="modal-items">
                        <template v-if="menulist.length > 0">
                            <div class="menu-list" v-for="(menu,i) in menulist">
                                <a class="menu-a" :class="{active: menu.active}" @click="setActive(i)">{{menu.title}}</a>
                                <div class="children" v-show="cur_main_idx == i">
                                    <template v-if="menu.child.length > 0">
                                        <a v-for="(child, j) in menu.child" :class="{active: child.active}" @click="setActive(i,j)">{{child.title}}</a>
                                    </template>
                                    <a class="menu-add-child" @click="addChildrenMenu(i)" v-if="menu.child.length < 5">
                                        <i class="icon ion-ios-plus-empty"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="menu-add" @click="addMenu" v-if="menulist.length < 3">
                                <i class="icon ion-ios-plus-empty"></i>
                            </div>
                        </template>
                        <div class="menu-empty" v-else @click="addMenu">
                            <i class="icon ion-ios-plus-empty"></i>添加菜单
                        </div>
                    </div>
                    <div class="bg-bottom">
                    </div>
                </div>
            </div>
            <div class="right-show pull-left" v-show="menulist.length > 0 && is_selectMenu">
                <i class="triangle-arrow"></i>
                <p class="time">
                    {{form.title}}
                    <!-- <a class="pull-right">删除菜单</a> -->
                    <el-popover ref="popover" popper-class="delete-popover" placement="bottom" width="290" v-model="show_del" trigger="click">
                        <div class="slot-txt">
                            <p>删除确认</p>
                            <p>删除后“{{form.title}}”菜单下设置的内容将被删除</p>
                            <p>
                                <el-button class="btn-green" @click="deleteMenu">确定</el-button>
                                <el-button @click="show_del = false">取消</el-button>
                            </p>
                        </div>
                        <a class="pull-right" slot="reference">删除菜单</a>
                    </el-popover>
                </p>
                <p class="p-tips" v-show="!!form.child && form.child.length > 0">已添加子菜单，仅可设置菜单名称。</p>
                <div class="layui-tab-item layui-show mt20">
                    <div class="layui-form">
                        <div class="layui-form-item">
                            <label class="layui-form-label">
                                菜单名称
                            </label>
                            <div class="layui-input-inline">
                                <input type="text" minlength="1" v-model="form.title" :placeholder="form.title" class="layui-input" @blur="nameCount">
                            </div>
                            <div class="tips-words" v-if="!!form.child">字数不超过4个汉字或8个字母</div>
                            <div class="tips-words" v-else>字数不超过8个汉字或16个字母</div>
                        </div>
                        <template v-if="!!form.child && form.child.length > 0"></template>
                        <div class="layui-form-item" v-else>
                            <label class="layui-form-label">
                                菜单内容
                            </label>
                            <div class="layui-input-inline">
                                <el-radio-group v-model="radio" @change="radioChange">
                                    <el-radio class="radio" :label="1">发送消息</el-radio>
                                    <el-radio class="radio" :label="3">跳转网页</el-radio>
                                    <!-- <el-radio class="radio" :label="3">跳转小程序</el-radio> -->
                                </el-radio-group>
                            </div>
                        </div>
                    </div>

                    <template v-if="!!form.child && form.child.length > 0"></template>
                    <template v-else>
                        <div class="send-msg" v-show="radio === 1">
                            <ul>
                                <li :class="{active: form.type === 1}" @click="changeType(1)">
                                    <i class="menu-con appmsg"></i>图文消息</li>
                                <li :class="{active: form.type === 2}" @click="changeType(2)">
                                    <i class="icon ion-android-create"></i>文字</li>
                                <li :class="{active: form.type === 4}" @click="changeType(4)">
                                    <i class="menu-con img"></i>图片</li>
                                <!-- <li :class="{active: msg_type === 3}" @click="msg_type = 3"><i class="menu-con voice"></i>语音</li>
                                    <li :class="{active: msg_type === 4}" @click="msg_type = 4"><i class="menu-con video"></i>视频</li> -->
                            </ul>
                            <div class="msg-con" v-show="form.type === 1">
                                <div v-show="form.news.length > 0" v-for="(newsitem, i) in form.news" class="news-item" :style="{backgroundImage: 'url('+ newsitem.cover +')'}">
                                    <span>{{newsitem.title}}</span>
                                    <div class="cover-del" @click="deleteNews(i)">
                                        <i class="icon ion-ios-trash"></i>
                                    </div>
                                </div>
                                <a class="select-outer" @click="dlgVisible = true" v-show="form.news && form.news.length < 8">
                                    <i class="icon ion-ios-plus-empty"></i>
                                    从素材库中选择
                                </a>
                                <!-- <a>
                                        <i class="icon ion-ios-plus-empty"></i>
                                        新建图文消息
                                    </a> -->

                            </div>
                            <div class="msg-con" v-show="form.type === 2">
                                <div class="txteditor" contenteditable="true" id="txteditor" @blur="txtBlur" tabindex="2"></div>
                            </div>
                            <div class="msg-con" v-show="form.type === 4">
                                <div v-if="form.media && form.media.path != ''" class="news-item" :style="{backgroundImage: 'url('+ form.media.path +')'}">
                                    <div class="cover-del" @click="deleteMedia">
                                        <i class="icon ion-ios-trash"></i>
                                    </div>
                                </div>
                                <a v-else class="select-outer" @click="showPhotoDlg = true">
                                    <i class="icon ion-ios-plus-empty"></i>
                                    从素材库中选择
                                </a>
                                <!-- <a class="select-outer">
                                        <i class="icon ion-ios-plus-empty"></i>
                                        上传图片
                                    </a> -->
                            </div>
                        </div>
                        <div class="send-msg jmp-link" v-show="radio === 3">
                            <p class="p-tips">
                                用户点击菜单按钮后跳转到以下链接
                            </p>
                            <div class="layui-form">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">
                                        页面地址
                                    </label>
                                    <div class="layui-input-inline">
                                        <input type="text" v-model.trim="form.url" placeholder="认证后才可手动输入地址" class="layui-input" @blur="setUrl">
                                    </div>
                                    <!-- <a class="tips-opr">从公众号图文消息中选择</a> -->
                                </div>
                            </div>
                        </div>

                    </template>
                </div>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="div-opr mt40" v-show="menulist.length > 0">
            <div class="left-opr pull-left mr20 text-center">
                <!-- <el-button>菜单排序</el-button> -->
            </div>
            <div class="right-opr pull-left">
                <el-button class="btn-green" @click="save">保存</el-button>
                <el-button class="btn-green" @click="publish">发布</el-button>
                <el-button @click="preview">预览</el-button>
            </div>
            <div class="clearfix"></div>
        </div>
        <!--预览-->
        <div id="selfview" class="selfview" v-show="show_preview" style="display: none;">
            <div class="phone mb30">
                <div class="phone-menu">
                    <div class="menu-list" v-for="(menu,i) in menulist">
                        <a class="menu-a" :class="{active: menu.active}" @click="showPreviewItem(i)">{{menu.title}}</a>
                        <div class="children" v-show="cur_main_idx == i && menu.child && menu.child.length > 0">
                            <a v-for="(child, j) in menu.child" :class="{active: child.active}">{{child.title}}</a>
                        </div>
                    </div>
                </div>
            </div>
            <el-button class="close" @click="previewClose">退出预览</el-button>
        </div>
        <material-select-dialog @closeDlg="closeDlg" :title="'选择图文'" :dialogVisible="dlgVisible">
        </material-select-dialog>
        <photo-select-dialog @closeDlg="closePhotoDlg" :title="'选择图片'" :dialogVisible="showPhotoDlg">
        </photo-select-dialog>
    </div>
</template>
<script>
import { basePage } from 'hanzi-vue-package';
tools.vue.use(basePage);
import materialSelectDialog from '../../components/wechat/Materialselectdialog.vue';
import photoSelectDialog from '../../components/wechat/Photoselectdialog.vue';
import { Input, Button, RadioGroup, Radio, Popover, Dialog } from 'element-ui';
tools.vue.use(Input);
tools.vue.use(Button);
tools.vue.use(RadioGroup);
tools.vue.use(Radio);
tools.vue.use(Popover);
tools.vue.use(Dialog);

export default {
    data() {
        this.crumbs.push({ name: '微信管理' }, { name: '自定义菜单' });
        return {
            title: '',
            radio: 1,
            msg_type: 1,
            jmp_link: '',
            menulist: [],
            cur_main_idx: 0,
            form: {
                title: '',
                news_ids: [],
            },
            idx: undefined,
            p_idx: undefined,
            show_preview: false,
            show_del: false,
            is_selectMenu: false,
            dlgVisible: false,
            has_checked: false,
            showPhotoDlg: false,

        }
    },
    props: ['crumbs'],
    computed: {

    },
    methods: {
        getData: function() {
            let that = this;

            tools.alert.loading();
            tools.ajax({
                url: '/api/admin/wechat/menus',
                ajaxData: {},
                successFun: function(res) {
                    tools.alert.closeLoading();
                    if (res && res.list) {
                        that.menulist = res.list;
                        for (let i in that.menulist) {
                            that.menulist[i].active = false;
                            that.menulist[i].idx = i;
                            for (let j in that.menulist[i].child) {
                                that.menulist[i].child[j].active = false;
                                that.menulist[i].child[j].idx = j;
                                that.menulist[i].child[j].p_idx = i;
                            }
                        }
                        if (that.menulist.length > 0) {
                            that.setActive(0);
                        }
                    }
                },
                errorFun: function(error_data, status, headers, error_obj) {
                    tools.alert.closeLoading();
                    tools.alert.error(error_data.error_msg);
                },
                type: 'GET'
            });

        },
        deleteMenu: function() {
            let that = this;
            if (!that.form.id) {
                if (that.form.p_idx !== undefined) {
                    that.menulist[that.form.p_idx].child.splice(that.form.idx, 1);
                }
                else {
                    that.menulist.splice(that.form.idx, 1);
                }
                that.show_del = false;
                that.is_selectMenu = false;
                return;
            }
            tools.alert.loading();
            tools.ajax({
                url: '/api/admin/wechat/menus/' + that.form.id,
                ajaxData: {},
                successFun: function(res) {
                    tools.alert.closeLoading();
                    if (res && res.status) {
                        if (that.form.p_idx !== undefined) {
                            that.menulist[that.form.p_idx].child.splice(that.form.idx, 1);
                        }
                        else {
                            that.menulist.splice(that.form.idx, 1);
                        }
                        that.show_del = false;
                        that.is_selectMenu = false;
                    }
                },
                errorFun: function(error_data, status, headers, error_obj) {
                    tools.alert.closeLoading();
                    tools.alert.error(error_data.error_msg);
                },
                type: 'DELETE'
            });

        },
        save: function() {
            let that = this, ajaxData = { menu: [] };
            for (let i in that.menulist) {
                let tmpOne = {};
                tmpOne.title = that.menulist[i].title;
                tmpOne.type = that.menulist[i].type;
                //debugger
                //0,无;1,图文;2,文字;3,跳转链接;4,图片;
                switch (Number(tmpOne.type)) {
                    case 1: {
                        if (that.menulist[i].news.length > 0) {
                            tmpOne.news_ids = [];
                            for (let news in that.menulist[i].news) {
                                tmpOne.news_ids.push({ news_id: that.menulist[i].news[news].id });
                            }
                        }
                        else {
                            tools.alert.message('请选择图文');
                            that.setActive(i);
                            return false;
                        }
                    }; break;
                    case 2: {
                        if (that.menulist[i].text === '') {
                            tools.alert.message('请输入文字');
                            that.setActive(i);
                            return false;
                        }
                        else {
                            tmpOne.text = that.menulist[i].text ? that.menulist[i].text : '';
                        }
                    }; break;
                    case 3: {
                        tmpOne.url = that.menulist[i].url;
                        if (tmpOne.url == '') {
                            tools.alert.message('请输入页面地址');
                            that.setActive(i);
                            return false;
                        }
                        else if (!/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/.test(tmpOne.url)) {
                            tools.alert.message('url格式错误');
                            that.setActive(i);
                            return false;
                        }
                    }; break;
                    case 4: {
                        if (that.menulist[i].media) {
                            tmpOne.media_id = that.menulist[i].media.id;
                        }
                        else {
                            tools.alert.message('请选择图片');
                            that.setActive(i);
                            return false;
                        }
                    }; break;
                }
                if (that.menulist[i].child.length > 0) {
                    let tmpChild = [];
                    for (let j in that.menulist[i].child) {
                        let tmpTwo = {};
                        tmpTwo.title = that.menulist[i].child[j].title;
                        tmpTwo.type = that.menulist[i].child[j].type;
                        switch (Number(tmpTwo.type)) {
                            case 1: {
                                if (that.menulist[i].child[j].news.length > 0) {
                                    tmpTwo.news_ids = [];
                                    for (let news in that.menulist[i].child[j].news) {
                                        tmpTwo.news_ids.push({ news_id: that.menulist[i].child[j].news[news].id });
                                    }
                                }
                                else {
                                    tools.alert.message('请选择图文');
                                    that.setActive(i, j);
                                    return false;
                                }
                            }; break;
                            case 2: {
                                if (that.menulist[i].child[j].text === '') {
                                    tools.alert.message('请输入文字');
                                    that.setActive(i, j);
                                    return false;
                                }
                                else {
                                    tmpTwo.text = that.menulist[i].child[j].text ? that.menulist[i].child[j].text : '';
                                }
                            }; break;
                            case 3: {
                                tmpTwo.url = that.menulist[i].child[j].url;
                                if (tmpTwo.url == '') {
                                    tools.alert.message('请输入页面地址');
                                    that.setActive(i, j);
                                    return false;
                                }
                                else if (!/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/.test(tmpTwo.url)) {
                                    tools.alert.message('url格式错误');
                                    that.setActive(i, j);
                                    return false;
                                }
                            }; break;
                            case 4: {
                                if (that.menulist[i].child[j].media) {
                                    tmpTwo.media_id = that.menulist[i].child[j].media.id;
                                }
                                else {
                                    tools.alert.message('请选择图片');
                                    that.setActive(i, j);
                                    return false;
                                }
                            }; break;
                        }
                        tmpChild.push(tmpTwo);
                    }
                    tmpOne.child = tmpChild;
                }
                else if (that.menulist[i].type === 0) {
                    tools.alert.message('请设置菜单内容');
                    that.setActive(i);
                    return false;
                }
                ajaxData.menu.push(tmpOne);
            }
            /*console.log(ajaxData);
            debugger*/
            tools.alert.loading();
            tools.ajax({
                url: '/api/admin/wechat/menus',
                ajaxData: ajaxData,
                successFun: function(res) {
                    tools.alert.closeLoading();
                    tools.alert.message('保存成功');
                },
                errorFun: function(error_data, status, headers, error_obj) {
                    tools.alert.closeLoading();
                    tools.alert.error(error_data.error_msg);
                },
                type: 'POST'
            });

        },
        publish: function() {
            tools.alert.loading();
            tools.ajax({
                url: '/api/admin/wechat/menus/1',
                ajaxData: {
                    action: 'publish'
                },
                successFun: function(res) {
                    tools.alert.closeLoading();
                    tools.alert.message('发布成功');
                },
                errorFun: function(error_data, status, headers, error_obj) {
                    tools.alert.closeLoading();
                    tools.alert.error(error_data.error_msg);
                },
                type: 'PUT'
            });

        },
        addMenu: function() {
            let that = this;
            that.cancelActive();
            that.menulist.push({
                title: '菜单名称',
                //name: '菜单名称'+(that.menulist.length + 1),
                //sort: that.menulist.length + 1,
                child: [],
                active: true,
                type: 0,
                text: '',
                url: '',
                media_id: 0,
                media: '',
                news: []
            });
            //that.cur_main_idx = that.menulist.length - 1;
            that.setActive(that.menulist.length - 1);
        },
        addChildrenMenu: function(i) {
            let that = this;
            that.cancelActive();
            that.menulist[i].type = 0;
            that.menulist[i].child.unshift({
                title: '子菜单名称',
                //name: '子菜单名称'+(that.menulist[i].children.length + 1),
                //sort: that.menulist[i].children.length + 1,
                active: true,
                type: 1,
                text: '',
                url: '',
                media_id: 0,
                media: '',
                news: []
            });
            that.setActive(i, 0);

        },
        setActive: function(i, j) {
            let that = this;
            that.cancelActive();
            if (j !== undefined) {
                that.idx = j;
                that.p_idx = i;
                that.menulist[i].child[j].active = true;
                that.menulist[i].child[j].idx = j;
                that.menulist[i].child[j].p_idx = i;
                that.form = null;
                that.form = that.menulist[i].child[j];
            }
            else {
                that.idx = i;
                that.p_idx = j;
                that.menulist[i].active = true;
                that.menulist[i].idx = i;
                that.form = null;
                that.form = that.menulist[i];
            }
            that.form = Object.assign({}, that.form);
            that.radio = that.form.type == 3 ? 3 : 1;
            if (that.form.type == 0) {
                that.radio = 0;
            }
            that.$nextTick(function() {
                $('#txteditor').html(that.form.text);
            });
            that.msg_type = that.form.type;
            that.cur_main_idx = i;
            that.is_selectMenu = true;
        },
        cancelActive: function() {
            let that = this;
            for (let i in that.menulist) {
                that.menulist[i].active = false;
                for (let j in that.menulist[i].child) {
                    that.menulist[i].child[j].active = false;
                }
            }
            $('#txteditor').empty();
        },
        changeType: function(i) {
            let that = this;
            that.form.type = i;
            if (!!that.form.child) {//主菜单
                that.menulist[that.idx].type = that.form.type;
            }
            else {
                that.menulist[that.p_idx].child[that.idx].type = that.form.type;
            }
        },
        radioChange: function() {
            let that = this;
            if (that.radio == 3) {
                that.form.type = 3;
            }
            else if (that.radio == 1) {
                if (that.form.news.length > 0) {
                    that.form.type = 1;
                }
                else if (that.form.text) {
                    that.form.type = 2;
                }
                else {
                    that.form.type = 4;
                }
            }

            if (!!that.form.child) {//主菜单
                that.menulist[that.idx].type = that.form.type;
            }
            else {
                that.menulist[that.p_idx].child[that.idx].type = that.form.type;
            }
        },
        txtBlur: function() {
            let that = this;
            that.form.text = $('#txteditor').html();
            if (!!that.form.child) {//主菜单
                that.menulist[that.idx].text = that.form.text;
            }
            else {
                that.menulist[that.p_idx].child[that.idx].text = that.form.text;
            }
        },
        preview: function() {
            let that = this;
            this.show_preview = true;
            layer.open({
                type: 1,
                closeBtn: 0,
                title: '',
                skin: 'clearbg',
                content: $('#selfview'),
                //,btn: ['确定']
                success: function() {
                }
            });
        },
        previewClose: function() {
            layer.closeAll();
            this.show_preview = false;
        },
        showPreviewItem: function(i) {
            let that = this;
            if (that.cur_main_idx === i) {
                that.cur_main_idx = -1;
            }
            else {
                that.cur_main_idx = i;
            }
        },
        getMaterial: function(page, page_size) {
            let that = this, ajaxData = {};
            that.dlgVisible = true
            if (page) {
                ajaxData.page = page;
            }
            if (that.inputTxt) {
                ajaxData.title = that.inputTxt;
            }

            tools.alert.loading();
            tools.ajax({
                url: '/api/admin/wechat/newses',
                ajaxData: ajaxData,
                successFun: function(res) {
                    tools.alert.closeLoading();
                    if (res && res.list) {
                        that.lists = res.list.data;
                        that.page = res.list;
                        for (let i in that.lists) {
                            that.lists[i].isShow = false;
                        }
                        that.lists = Object.assign({}, that.lists);
                    }
                },
                errorFun: function(error_data, status, headers, error_obj) {
                    tools.alert.closeLoading();
                    tools.alert.error(error_data.error_msg);
                },
                type: 'GET'
            });
        },
        deleteNews: function(idx) {
            let that = this;
            that.form.news.splice(idx, 1);
        },
        closePhotoDlg: function(obj) {
            let that = this;
            that.showPhotoDlg = false;
            if (obj) {
                that.form.media = {};
                that.form.media.path = obj.img_arr[0].path;
                if (!!that.form.child) {//主菜单
                    that.menulist[that.idx].media.path = that.form.media.path;
                    that.menulist[that.idx].media.id = obj.img_arr[0].id;
                }
                else {
                    that.menulist[that.p_idx].child[that.idx].media = {};
                    that.menulist[that.p_idx].child[that.idx].media.path = that.form.media.path;
                    that.menulist[that.p_idx].child[that.idx].media.id = obj.img_arr[0].id;
                }
            }
        },
        deleteMedia: function() {
            let that = this;
            that.form.media = '';
            if (!!that.form.child) {//主菜单
                that.menulist[that.idx].media = that.form.media;
                that.menulist[that.idx].media_id = 0;
            }
            else {
                that.menulist[that.p_idx].child[that.idx].media = that.form.media;
                that.menulist[that.p_idx].child[that.idx].media_id = 0;
            }
        },
        closeDlg: function(obj) {
            let that = this;
            that.dlgVisible = false;
            if (obj) {
                that.form.news.push({
                    id: obj.img_arr[0].id,
                    cover: obj.img_arr[0].cover,
                    title: obj.img_arr[0].title,
                    url: obj.img_arr[0].url
                });
            }
        },
        nameCount: function() {
            let that = this;
            if (!!that.form.child) {//主菜单
                that.form.title = that.charCount(that.form.title, 8);
                that.menulist[that.idx].title = that.form.title;
            }
            else {
                that.form.title = that.charCount(that.form.title, 16);
                that.menulist[that.p_idx].child[that.idx].title = that.form.title;
            }
        },
        setUrl: function() {
            let that = this;
            if (that.form.url != '' && !/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/.test(that.form.url)) {
                tools.alert.message('url格式错误');
            }
            if (!!that.form.child) {//主菜单
                that.menulist[that.idx].url = that.form.url;
            }
            else {
                that.menulist[that.p_idx].child[that.idx].url = that.form.url;
            }

        },
        //计算字数, 1个汉字等于2个字符
        charCount: function(d, size) {
            let that = this;
            let count = that.dataLength(d);
            let tmpData = '';
            if (count > size) {
                var intLength = 0;
                for (var i = 0; i < d.length; i++) {
                    if ((d.charCodeAt(i) < 0) || (d.charCodeAt(i) > 255)) {
                        intLength = intLength + 2
                    }
                    else {
                        intLength = intLength + 1
                    }
                    if (intLength <= size) {
                        tmpData += d[i];
                    }
                    else {
                        break;
                    }
                }
            }
            else {
                return d;
            }
            return tmpData;

        },
        //* 出口参数：返回fData的长度(Unicode长度为2，非Unicode长度为1) 
        dataLength: function(fData) {
            var intLength = 0
            for (var i = 0; i < fData.length; i++) {
                if ((fData.charCodeAt(i) < 0) || (fData.charCodeAt(i) > 255))
                    intLength = intLength + 2
                else
                    intLength = intLength + 1
            }
            return intLength
        }


    },
    components: {
        photoSelectDialog,
        materialSelectDialog
    },
    filters: {
        date: function(timestamp, format) {
            //let f = 'Y-m-d H:i';
            let f = 'Y年m月d日';
            if (format) {
                f = format;
            }
            return tools.date(f, timestamp);
        },

    },
    watch: {

    },
    mounted() {
        let that = this;
        that.getData();
    }
}
</script>
<style rel="stylesheet/scss" lang="scss">
@import "../../assets/tool";
@import "../../assets/sass/common/wechat_btn";
[i="wechat-selfmenu"] {
    .layui-form-label {
        width: 80px;
    }

    .tips {
        background-color: #f1f2f7;
        padding: 25px;
        .warning {
            display: inline-block;
            width: 38px;
            height: 38px;
            background: url(../../assets/warning.png) no-repeat center center/cover;
        }
    }
    .div-show {
        .left-show {
            width: 320px;
            height: 582px;
            .modal-header {
                height: 64px;
                background: url(../../assets/bg_mobile_head_default.png) no-repeat 0 0/contain;
            }
            .modal-body {
                height: 518px;
                border: 1px solid #e7e7eb;
                border-top: 0;
                position: relative;
                .bg-bottom {
                    border-top: 1px solid #e7e7eb;
                    position: absolute;
                    bottom: 0;
                    width: 100%;
                    height: 50px;
                    background: url(../../assets/bg_mobile_foot_default.png) rgb(250, 250, 250) no-repeat 0 0/contain;
                }
                .modal-items {
                    z-index: 2;
                    position: absolute;
                    bottom: -1px;
                    right: 0;
                    width: 276px;
                    height: 51px;
                    display: flex;
                    &>div {
                        text-align: center;
                        flex-grow: 1;
                        align-items: stretch;
                        line-height: 51px;
                        position: relative;
                        min-width: 92px;
                    }
                    .menu-list {
                        a.active {
                            border: 1px solid #44b549;
                            color: #44b549;
                        }
                        .menu-a {
                            color: #222;
                            display: block;
                            height: 51px;
                            border: 1px solid transparent;
                            border-right: 1px solid #e7e7eb;
                            @include wordEllipsis();
                        }
                        .children {
                            border: 1px solid #e7e7eb;
                            width: 100%;
                            position: absolute;
                            bottom: 65px;
                            a {
                                color: #222;
                                display: block;
                                text-align: center;
                                height: 52px;
                                margin-left: -1px;
                                margin-right: -1px;
                                border: 1px solid transparent;
                                border-bottom: 1px solid #e7e7eb;
                                &:last-child {
                                    border-bottom: none;
                                }
                                &.active {
                                    color: #44b549;
                                    border: 1px solid #44b549;
                                }
                            }
                            .menu-add-child {
                                border-bottom: none;
                                i {
                                    font-size: 28px;
                                    vertical-align: middle;
                                    margin-right: 5px;
                                    color: #8d8d8d;
                                }
                            }
                            &:before {
                                content: '';
                                position: absolute;
                                left: 43%;
                                bottom: -7px;
                                border-style: solid;
                                border-width: 7px 7px 0;
                                border-color: #e7e7eb transparent;
                            }
                            &:after {
                                content: '';
                                position: absolute;
                                left: 43%;
                                bottom: -6px;
                                border-style: solid;
                                border-width: 7px 7px 0;
                                border-color: #fff transparent;
                            }
                        }
                    }
                    .menu-empty {
                        i {
                            font-size: 28px;
                            vertical-align: middle;
                            margin-right: 5px;
                        }
                        width: 276px;
                        height: 51px;
                        line-height: 51px;
                        text-align: center;
                        border: 1px solid #44b549;
                        color: #44b549;
                    }
                    .menu-add {
                        i {
                            font-size: 28px;
                            vertical-align: middle;
                            /* margin-right: 5px; */
                            margin: 0 auto;
                            width: 66px;
                            display: block;
                            color: #8d8d8d;
                        }
                    }
                }
            }
        }
        .right-show {
            background-color: #f1f2f7;
            width: 600px;
            height: 582px;
            position: relative;
            border: 1px solid #e7e7eb;
            padding: 20px;
            padding-top: 10px;
            .time {
                padding-bottom: 10px;
                margin-bottom: 10px;
                border-bottom: 1px solid #e7e7eb;
                height: 30px;
            }
            .p-tips {
                color: #8d8d8d;
            }
            .layui-form-item {
                .layui-form-label {
                    text-align: left;
                }
                .layui-input-inline {
                    width: 300px;
                }
                .tips-words {
                    padding-left: 100px;
                    display: block;
                    clear: both;
                    color: #8d8d8d;
                    padding-top: 5px;
                }
                .tips-opr {
                    padding-left: 100px;
                    display: inline-block;
                    clear: both;
                    padding-top: 15px;
                }
                .el-radio-group {
                    padding-top: 10px;
                }
            }
            .send-msg {
                border: 1px solid #e7e7eb;
                background-color: #fff;
                ul {
                    border-bottom: 1px solid #e7e7eb;
                    height: 100%;
                    overflow: auto;
                    padding-left: 30px;
                    li {
                        height: 39px;
                        line-height: 39px;
                        float: left;
                        position: relative;
                        cursor: pointer;
                        color: #8d8d8d;
                        margin-right: 40px;
                        i.icon {
                            font-size: 20px;
                            vertical-align: middle;
                            color: #8d8d8d;
                            padding-right: 5px;
                        }
                        i.menu-con {
                            vertical-align: top;
                            background-image: url(../../assets/msg_tab.png);
                            display: inline-block;
                            margin-right: 3px;
                            &.appmsg {
                                width: 20px;
                                height: 30px;
                                background-position-y: 179px;
                            }
                            &.img {
                                width: 20px;
                                height: 30px;
                                background-position-y: 359px;
                            }
                            &.voice {
                                width: 20px;
                                height: 30px;
                                background-position-y: 238px;
                            }
                            &.video {
                                width: 20px;
                                height: 30px;
                                background-position-y: 299px;
                            }
                        }
                        &.active {
                            color: #222!important;
                            .icon {
                                color: #222!important;
                            }
                            .appmsg {
                                background-position-y: 149px!important;
                            }
                            .img {
                                width: 20px;
                                height: 30px;
                                background-position-y: 329px!important;
                            }
                            .voice {
                                width: 20px;
                                height: 30px;
                                background-position-y: 208px!important;
                            }
                            .video {
                                width: 20px;
                                height: 30px;
                                background-position-y: 269px!important;
                            }
                        }
                        &:hover i {
                            &.appmsg {
                                background-position-y: 149px;
                            }
                            &.img {
                                width: 20px;
                                height: 30px;
                                background-position-y: 329px;
                            }
                            &.voice {
                                width: 20px;
                                height: 30px;
                                background-position-y: 208px;
                            }
                            &.video {
                                width: 20px;
                                height: 30px;
                                background-position-y: 269px;
                            }
                        }
                    }
                }
                .msg-con {
                    width: 100%;
                    min-height: 213px;
                    max-height: 325px;
                    overflow-y: auto;
                    padding: 15px;

                    .news-item {
                        width: 217px;
                        height: 145px;
                        background-repeat: no-repeat;
                        background-position: center center;
                        background-size: cover;
                        position: relative;
                        margin-left: 20px;
                        margin-top: 10px;
                        background-color: #ececec;
                        span {
                            width: 100%;
                            height: 28px;
                            line-height: 28px;
                            color: #fff;
                            position: absolute;
                            bottom: 0;
                            padding: 0 10px;
                            display: inline-block;
                            @include wordEllipsis();
                            background-color: rgba(0, 0, 0, .5);
                        }
                        .cover-del {
                            width: 100%;
                            height: 100%;
                            position: absolute;
                            display: none;
                            line-height: 145px;
                            text-align: center;
                            color: #fff;
                            font-size: 64px;
                            cursor: pointer;
                        }
                        &:hover .cover-del {
                            display: block;
                            background-color: rgba(0, 0, 0, .5);
                        }
                    }
                    .select-outer {
                        color: #8d8d8d;
                        width: 217px;
                        height: 145px;
                        border: 2px dotted #e7e7eb;
                        display: inline-block;
                        font-size: 14px;
                        text-align: center;
                        padding-top: 10px;
                        margin-top: 20px;
                        margin-left: 20px;
                        i {
                            font-size: 64px;
                            display: block;
                        }
                        &:first-child {
                            margin-right: 30px;
                        }
                    }
                    .txteditor {
                        min-height: 183px;
                        outline: 0;
                        max-height: 295px;
                        overflow: auto;
                        overflow-x: hidden;
                        word-break: break-all;
                        line-height: 20px;
                    }
                }
            }
            .jmp-link {
                padding: 20px;
                .p-tips {
                    margin-bottom: 15px;
                }
                input {}
            }
            .triangle-arrow {
                &:before {
                    content: '';
                    position: absolute;
                    left: -15px;
                    bottom: 15px;
                    border-style: solid;
                    border-width: 15px 15px 15px 0;
                    border-color: transparent #f1f2f7;
                }
            }
        }
    }
    .div-opr {
        .left-opr {
            width: 320px;
            height: 46px;
        }
        .right-opr {}
    }

    #selfview {
        text-align: center;
        .phone {
            width: 327px;
            height: 674px;
            background: url(../../assets/bg_mobile.png) no-repeat 0 0;
            clear: both;
            position: relative;
            .phone-menu {
                position: absolute;
                bottom: 93px;
                left: 64px;
                width: 235px;
                display: flex;
                &>div {
                    text-align: center;
                    flex-grow: 1;
                    align-items: stretch;
                    line-height: 38px;
                    position: relative;
                }
                .menu-list {
                    .menu-a {
                        color: #222;
                        display: block;
                        height: 38px;
                        border-left: 1px solid #e7e7eb;
                    }
                    .children {
                        border: 1px solid #e7e7eb;
                        width: 100%;
                        position: absolute;
                        bottom: 55px;
                        background-color: #fff;
                        padding-left: 5px;
                        a {
                            color: #222;
                            display: block;
                            text-align: center;
                            height: 30px;
                            line-height: 30px;
                            margin-left: -1px;
                            margin-right: -1px;
                            @include wordEllipsis();
                            &:last-child {
                                border-bottom: none;
                            }
                        }
                        &:before {
                            content: '';
                            position: absolute;
                            left: 43%;
                            bottom: -7px;
                            border-style: solid;
                            border-width: 7px 7px 0;
                            border-color: #fff transparent;
                        }
                    }
                }
            }
        }
        .close {}
    }
    .clearbg {
        background: transparent;
        box-shadow: none;
    }
}

.btn-autowidth {
    width: auto;
}

.menu-popover {
    z-index: 20000000!important;
}

.delete-popover {
    padding: 30px !important;
}

.slot-txt {
    font-size: 14px;
    p {
        margin-bottom: 5px;
        &:last-child {
            margin-top: 20px;
        }
    }
}
</style>
